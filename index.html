<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON ডাটা ম্যানেজমেন্ট টুল</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Hind Siliguri', sans-serif;
        }
        .modal {
            transition: opacity 0.25s ease;
        }
        .modal-active {
            overflow-x: hidden;
            overflow-y: auto;
        }
        .modal-container {
            transition: all 0.25s ease;
        }
        .modal.hidden .modal-container {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <div class="bg-white p-6 rounded-2xl shadow-lg mb-6">
            <h1 class="text-3xl font-bold text-center text-gray-700 mb-2">ডাটা ম্যানেজমেন্ট টুল</h1>
            <p class="text-center text-gray-500 mb-6">আপনার data.json ফাইলটি আপলোড করে ডাটা ম্যানেজ করুন।</p>
            
            <div class="flex flex-col items-center justify-center bg-gray-50 p-6 rounded-lg border-2 border-dashed border-gray-300">
                <label for="file-upload" class="cursor-pointer bg-blue-500 text-white font-semibold py-2 px-5 rounded-lg shadow-md hover:bg-blue-600 transition-all">
                    data.json ফাইল আপলোড করুন
                </label>
                <input id="file-upload" type="file" class="hidden" accept=".json">
                <p id="file-name" class="mt-3 text-sm text-gray-600">কোনো ফাইল সিলেক্ট করা হয়নি</p>
            </div>
        </div>

        <div id="data-controls" class="hidden">
            <div class="bg-white p-6 rounded-2xl shadow-lg mb-6">
                <div class="grid md:grid-cols-2 gap-4 items-center">
                    <input type="text" id="search-input" placeholder="সিরিয়াল, প্রশ্ন বা উত্তর দিয়ে খুঁজুন..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                    <div class="flex flex-col md:flex-row gap-4">
                        <button id="add-new-btn" class="w-full bg-green-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-600 transition-all shadow-md">নতুন ডাটা যোগ করুন</button>
                        <button id="download-btn" class="w-full bg-indigo-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-600 transition-all shadow-md">আপডেটেড ফাইল ডাউনলোড করুন</button>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-600">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                        <tr>
                            <th scope="col" class="px-6 py-3">সিরিয়াল</th>
                            <th scope="col" class="px-6 py-3">প্রশ্ন</th>
                            <th scope="col" class="px-6 py-3">উত্তর</th>
                            <th scope="col" class="px-6 py-3 text-center">অ্যাকশন</th>
                        </tr>
                    </thead>
                    <tbody id="data-table-body">
                        <!-- Data rows will be inserted here by JavaScript -->
                    </tbody>
                </table>
                 <p id="no-results" class="text-center py-8 text-gray-500 hidden">কোনো ডাটা পাওয়া যায়নি।</p>
            </div>
        </div>
    </div>

    <!-- Modal for Add/Edit -->
    <div id="form-modal" class="modal fixed w-full h-full top-0 left-0 flex items-center justify-center z-50 hidden bg-black bg-opacity-50">
        <div class="modal-container bg-white w-11/12 md:max-w-3xl mx-auto rounded-2xl shadow-lg z-50 flex flex-col max-h-[90vh] transform transition-all duration-300">
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-5 border-b sticky top-0 bg-white rounded-t-2xl z-10">
                <p id="modal-title" class="text-2xl font-bold text-gray-800">ফর্ম</p>
                <button id="modal-close-btn" class="cursor-pointer z-50 p-2 rounded-full hover:bg-gray-200 transition-colors">
                    <svg class="h-5 w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body overflow-y-auto">
                <form id="data-form" class="p-6 space-y-6">
                    <input type="hidden" id="edit-id">

                    <!-- Section 1: Basic Info -->
                    <fieldset class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="serial_no" class="block text-sm font-semibold text-gray-600 mb-1">সিরিয়াল নং (বাংলায়)</label>
                            <input type="text" id="serial_no" class="mt-1 block w-full bg-gray-50 border border-gray-300 rounded-lg shadow-sm py-2 px-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                        <div>
                            <label for="year" class="block text-sm font-semibold text-gray-600 mb-1">বছর</label>
                            <input type="number" id="year" class="mt-1 block w-full bg-gray-50 border border-gray-300 rounded-lg shadow-sm py-2 px-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                    </fieldset>
                    
                    <hr/>

                    <!-- Section 2: Core Content -->
                    <fieldset class="space-y-4">
                        <div>
                            <label for="question" class="block text-sm font-semibold text-gray-600 mb-1">প্রশ্ন</label>
                            <textarea id="question" rows="2" class="mt-1 block w-full bg-gray-50 border border-gray-300 rounded-lg shadow-sm py-2 px-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"></textarea>
                        </div>
                        <div>
                            <label for="answer" class="block text-sm font-semibold text-gray-600 mb-1">উত্তর</label>
                            <textarea id="answer" rows="3" class="mt-1 block w-full bg-gray-50 border border-gray-300 rounded-lg shadow-sm py-2 px-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"></textarea>
                        </div>
                        <div>
                            <label for="details" class="block text-sm font-semibold text-gray-600 mb-1">বিস্তারিত</label>
                            <textarea id="details" rows="4" class="mt-1 block w-full bg-gray-50 border border-gray-300 rounded-lg shadow-sm py-2 px-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"></textarea>
                        </div>
                    </fieldset>
                    
                    <hr/>
                    
                    <!-- Section 3: Legal & Reference -->
                    <fieldset class="space-y-4">
                         <div>
                            <label for="key_point" class="block text-sm font-semibold text-gray-600 mb-1">মূল পয়েন্ট</label>
                            <input type="text" id="key_point" class="mt-1 block w-full bg-gray-50 border border-gray-300 rounded-lg shadow-sm py-2 px-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                        <div>
                            <label for="law_section" class="block text-sm font-semibold text-gray-600 mb-1">আইনের ধারা</label>
                            <input type="text" id="law_section" class="mt-1 block w-full bg-gray-50 border border-gray-300 rounded-lg shadow-sm py-2 px-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                        <div>
                            <label for="case_reference" class="block text-sm font-semibold text-gray-600 mb-1">মামলার রেফারেন্স</label>
                            <input type="text" id="case_reference" class="mt-1 block w-full bg-gray-50 border border-gray-300 rounded-lg shadow-sm py-2 px-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                    </fieldset>
                    
                    <hr/>

                    <!-- Section 4: Categorization -->
                     <fieldset class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="tags" class="block text-sm font-semibold text-gray-600 mb-1">ট্যাগ (কমা দিয়ে আলাদা)</label>
                            <input type="text" id="tags" class="mt-1 block w-full bg-gray-50 border border-gray-300 rounded-lg shadow-sm py-2 px-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                        <div>
                            <label for="keywords" class="block text-sm font-semibold text-gray-600 mb-1">কীওয়ার্ড (কমা দিয়ে আলাদা)</label>
                            <input type="text" id="keywords" class="mt-1 block w-full bg-gray-50 border border-gray-300 rounded-lg shadow-sm py-2 px-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                     </fieldset>
                    <hr/>
                    <!-- Section 5: Source & Relations -->
                    <fieldset class="space-y-4">
                        <div>
                            <label for="source" class="block text-sm font-semibold text-gray-600 mb-1">সোর্স</label>
                            <input type="text" id="source" class="mt-1 block w-full bg-gray-50 border border-gray-300 rounded-lg shadow-sm py-2 px-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                        <div>
                            <label for="law_reference_link" class="block text-sm font-semibold text-gray-600 mb-1">আইন রেফারেন্স লিংক</label>
                            <input type="url" id="law_reference_link" class="mt-1 block w-full bg-gray-50 border border-gray-300 rounded-lg shadow-sm py-2 px-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                        <div>
                            <label for="related_ids" class="block text-sm font-semibold text-gray-600 mb-1">সম্পর্কিত আইডি (কমা দিয়ে আলাদা)</label>
                            <input type="text" id="related_ids" class="mt-1 block w-full bg-gray-50 border border-gray-300 rounded-lg shadow-sm py-2 px-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                        </div>
                    </fieldset>
                </form>
            </div>
            
            <!-- Modal Footer -->
            <div class="flex justify-end items-center gap-4 p-5 border-t sticky bottom-0 bg-gray-50 rounded-b-2xl z-10">
                <button type="button" id="modal-cancel-btn" class="bg-gray-200 text-gray-800 font-bold py-2 px-6 rounded-lg hover:bg-gray-300 transition-all shadow-sm">বাতিল</button>
                <button type="submit" form="data-form" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition-all shadow-sm">সংরক্ষণ করুন</button>
            </div>
        </div>
    </div>
    
<script>
    document.addEventListener('DOMContentLoaded', () => {
        let jsonData = [];
        const fileUpload = document.getElementById('file-upload');
        const fileNameDisplay = document.getElementById('file-name');
        const dataControls = document.getElementById('data-controls');
        const tableBody = document.getElementById('data-table-body');
        const searchInput = document.getElementById('search-input');
        const noResults = document.getElementById('no-results');

        const modal = document.getElementById('form-modal');
        const modalTitle = document.getElementById('modal-title');
        const form = document.getElementById('data-form');
        const editIdInput = document.getElementById('edit-id');

        const bengaliToEnglishNumber = (str) => {
            const bengaliDigits = ['০', '১', '২', '৩', '৪', '৫', '৬', '৭', '৮', '৯'];
            const englishDigits = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
            let englishStr = '';
            if (typeof str !== 'string') return '';
            for (let i = 0; i < str.length; i++) {
                const index = bengaliDigits.indexOf(str[i]);
                if (index !== -1) {
                    englishStr += englishDigits[index];
                } else {
                    if(!isNaN(parseInt(str[i]))){
                         englishStr += str[i];
                    }
                }
            }
            return englishStr;
        };

        const englishToBengaliNumber = (str) => {
            const englishDigits = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
            const bengaliDigits = ['০', '১', '২', '৩', '৪', '৫', '৬', '৭', '৮', '৯'];
            let bengaliStr = '';
            if (typeof str !== 'string') str = String(str);
            for (let i = 0; i < str.length; i++) {
                const index = englishDigits.indexOf(str[i]);
                if (index !== -1) {
                    bengaliStr += bengaliDigits[index];
                } else {
                    bengaliStr += str[i];
                }
            }
            return bengaliStr;
        };

        const getNextAvailableId = () => {
            if (jsonData.length === 0) {
                return 1;
            }
            const existingIds = new Set(jsonData.map(item => item.id));
            let nextId = 1;
            while (existingIds.has(nextId)) {
                nextId++;
            }
            return nextId;
        };

        fileUpload.addEventListener('change', event => {
            const file = event.target.files[0];
            if (file) {
                fileNameDisplay.textContent = file.name;
                const reader = new FileReader();
                reader.onload = e => {
                    try {
                        jsonData = JSON.parse(e.target.result);
                        renderTable(jsonData);
                        dataControls.classList.remove('hidden');
                    } catch (error) {
                        alert('ত্রুটি: ফাইলটি সঠিক JSON ফরম্যাটে নেই।');
                        console.error("JSON parsing error:", error);
                    }
                };
                reader.readAsText(file);
            }
        });

        const renderTable = (data) => {
            tableBody.innerHTML = '';
            if (data.length === 0) {
                noResults.classList.remove('hidden');
            } else {
                 noResults.classList.add('hidden');
            }
            
            data.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'bg-white border-b hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 font-bold text-gray-900">${item.serial_no || ''}</td>
                    <td class="px-6 py-4">${item.question || ''}</td>
                    <td class="px-6 py-4">${item.answer || ''}</td>
                    <td class="px-6 py-4 text-center">
                        <button class="edit-btn text-blue-600 hover:underline font-semibold" data-id="${item.id}">এডিট</button>
                        <button class="delete-btn text-red-600 hover:underline font-semibold ml-4" data-id="${item.id}">ডিলিট</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        };

        searchInput.addEventListener('keyup', () => {
            const searchTerm = searchInput.value.toLowerCase();
            const filteredData = jsonData.filter(item => 
                (item.serial_no && item.serial_no.toString().toLowerCase().includes(searchTerm)) ||
                (item.question && item.question.toLowerCase().includes(searchTerm)) ||
                (item.answer && item.answer.toLowerCase().includes(searchTerm))
            );
            renderTable(filteredData);
        });

        const openModal = (title, data = null) => {
            const serialNoInput = document.getElementById('serial_no');
            modalTitle.textContent = title;
            form.reset();
            
            if (data) { // Editing existing data
                editIdInput.value = data.id;
                serialNoInput.value = data.serial_no || '';
                serialNoInput.readOnly = false; // Allow editing serial for existing items
                document.getElementById('question').value = data.question || '';
                document.getElementById('answer').value = data.answer || '';
                document.getElementById('details').value = data.details || '';
                document.getElementById('key_point').value = data.key_point || '';
                document.getElementById('law_section').value = data.law_section || '';
                document.getElementById('case_reference').value = data.case_reference || '';
                document.getElementById('tags').value = Array.isArray(data.tags) ? data.tags.join(', ') : '';
                document.getElementById('keywords').value = Array.isArray(data.keywords) ? data.keywords.join(', ') : '';
                document.getElementById('year').value = data.year || '';
                document.getElementById('source').value = data.source || '';
                document.getElementById('law_reference_link').value = data.law_reference_link || '';
                document.getElementById('related_ids').value = Array.isArray(data.related_ids) ? data.related_ids.join(', ') : '';
            } else { // Adding new data
                editIdInput.value = '';
                const nextId = getNextAvailableId();
                const nextSerialNo = englishToBengaliNumber(nextId.toString());
                serialNoInput.value = nextSerialNo;
                serialNoInput.readOnly = true; // Make serial read-only for new items
            }
            modal.classList.remove('hidden');
            document.body.classList.add('modal-active');
        };

        const closeModal = () => {
            modal.classList.add('hidden');
            document.body.classList.remove('modal-active');
        };

        document.getElementById('add-new-btn').addEventListener('click', () => {
            openModal('নতুন ডাটা যোগ করুন');
        });
        
        tableBody.addEventListener('click', e => {
            if (e.target.classList.contains('edit-btn')) {
                const id = e.target.getAttribute('data-id');
                const dataToEdit = jsonData.find(item => item.id == id);
                if (dataToEdit) {
                    openModal('ডাটা এডিট করুন', dataToEdit);
                }
            }
             if (e.target.classList.contains('delete-btn')) {
                const id = e.target.getAttribute('data-id');
                if(confirm('আপনি কি এই ডাটাটি ডিলিট করতে চান?')) {
                    jsonData = jsonData.filter(item => item.id != id);
                    renderTable(jsonData);
                }
            }
        });

        document.getElementById('modal-close-btn').addEventListener('click', closeModal);
        document.getElementById('modal-cancel-btn').addEventListener('click', closeModal);

        form.addEventListener('submit', e => {
            e.preventDefault();
            const idToEdit = editIdInput.value;
            const serialNo = document.getElementById('serial_no').value;
            const englishSerialStr = bengaliToEnglishNumber(serialNo);
            const newId = parseInt(englishSerialStr, 10);

            if (isNaN(newId)) {
                alert('অনুগ্রহ করে সঠিক সিরিয়াল নম্বর দিন।');
                return;
            }

            const isDuplicate = jsonData.some(item => {
                if (idToEdit && item.id == idToEdit) {
                    return false;
                }
                return item.id === newId;
            });

            if (isDuplicate) {
                alert('ত্রুটি: এই সিরিয়াল নম্বরটি ইতিমধ্যে ব্যবহার করা হয়েছে। অনুগ্রহ করে অন্য একটি নম্বর দিন।');
                return;
            }

            const formData = {
                id: newId,
                serial_no: serialNo,
                question: document.getElementById('question').value,
                answer: document.getElementById('answer').value,
                details: document.getElementById('details').value,
                key_point: document.getElementById('key_point').value,
                law_section: document.getElementById('law_section').value,
                case_reference: document.getElementById('case_reference').value,
                tags: document.getElementById('tags').value.split(',').map(s => s.trim()).filter(Boolean),
                keywords: document.getElementById('keywords').value.split(',').map(s => s.trim()).filter(Boolean),
                year: parseInt(document.getElementById('year').value) || null,
                source: document.getElementById('source').value,
                law_reference_link: document.getElementById('law_reference_link').value,
                related_ids: document.getElementById('related_ids').value.split(',').map(s => parseInt(bengaliToEnglishNumber(s.trim()))).filter(num => !isNaN(num)),
                last_updated: new Date().toISOString().split('T')[0]
            };

            if (idToEdit) {
                const index = jsonData.findIndex(item => item.id == idToEdit);
                if (index !== -1) {
                    const originalData = jsonData[index];
                    jsonData[index] = { ...originalData, ...formData };
                }
            } else {
                jsonData.push(formData);
            }
            
            jsonData.sort((a, b) => (parseInt(bengaliToEnglishNumber(a.serial_no), 10) || 0) - (parseInt(bengaliToEnglishNumber(b.serial_no), 10) || 0));

            renderTable(jsonData);
            closeModal();
        });

        document.getElementById('download-btn').addEventListener('click', () => {
            const dataStr = JSON.stringify(jsonData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'data_updated.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        });
    });
</script>

</body>
</html>

